# The term structure of risk-free yields {#TSModels}


<!-- ```{r extractECB, echo=TRUE, fig.cap="Simulation of a quadratic processes $x_t$.", fig.asp = .6, out.width = "95%", fig.align = 'left-aligned', message=FALSE} -->
<!-- library(ecb) -->
<!-- rates <- get_data( -->
<!--   #"YC.B.U2.EUR.4F.G_N_A.SV_C_YM.SR_10Y", -->
<!--   "FM.M.U2.EUR.4F.BB.R_U2_10Y.YLDA", -->
<!--   filter=list(startPeriod="1991-12")) -->
<!-- plot(as.Date(paste(rates$obstime,"-15",sep="")),rates$obsvalue,type="l") -->
<!-- spf <- get_data( -->
<!--   "SPF.Q.U2.HICP.POINT.LT.Q.AVG", -->
<!--   filter=list(startPeriod="1991-12")) -->
<!-- spf$obstime <- gsub("Q1", "02-15", spf$obstime) -->
<!-- spf$obstime <- gsub("Q2", "05-15", spf$obstime) -->
<!-- spf$obstime <- gsub("Q3", "08-15", spf$obstime) -->
<!-- spf$obstime <- gsub("Q4", "11-15", spf$obstime) -->
<!-- lines(as.Date(paste(spf$obstime,"-15",sep="")),spf$obsvalue,lty=3) -->
<!-- ``` -->


## Introduction {#RFIntroduction}

Risk-free yields are the yields-to-maturity associated with bonds that carry no default and/or liquidity risks. Bonds issued by sovereign entities with top credit quality are usually considered to be risk-free. Because of call-margins mechanisms, swap rates are also used as risk-free benchmarks [@Duffie_Stein_2015] (see Subsection \@ref(Swaps)). (Credit and liquidity risks are covered in Section \@ref(CreditLiRisks).)

An important share of the term-structure literature pertains to the modelling of risk-free yields. Some models involve macro factors in $w_t$ [@Ang_Piazzesi_2003]; some do not [@Duffie_Singleton_1997]. The latter are sometimes called *yield-only* models.

The basic pricing formula of a risk-free zero coupon bond is (see Eq. \@ref(eq:ihandM)):
\begin{eqnarray}
B_{t,h} &=& \exp(-i_{t}) \mathbb{E}^{\mathbb{Q}}_t \exp(-i_{t+1}-\dots-i_{t+h-1})\\
i_{t,h} &=& - \frac{1}{h} \log B_{t,h}. (\#eq:stdbondRFchapter)
\end{eqnarray}

Term structure models are often used to extract *term premiums* from observed yields-to-maturity. Term premiums are those components of yields that would not exist if investors were not risk-averse.

If agents were not risk averse, i.e., under the *Expectation Hypothesis (EH)*, we would have $\mathcal{M}_{t,t+1} = \exp(- i_t)$. We would then have $\mathbb{P} \equiv \mathbb{Q}$  and $B_{t,h}$ would be equal to:
\begin{equation}
B^{EH}_{t,h} := \exp(-i_{t}) \mathbb{E}_t \exp(-i_{t+1}-\dots-i_{t+h-1}).(\#eq:stdbondRFchapterP)
\end{equation}
And the maturity-$h$ yield-to-maturity would then be:
\begin{eqnarray}
i^{EH}_{t,h} &=& -\frac{1}{h}\log \left( \mathbb{E}_t \exp(-i_t-\dots-i_{t+h-1})\right)\nonumber\\
&\approx& \frac{1}{h}\mathbb{E}_t(i_t + \dots + i_{t+h-1}).(\#eq:REH)
\end{eqnarray}

The term premium is given by:
\begin{eqnarray}
TP_{t,h} &=& \underbrace{- \frac{1}{h} \log  \mathbb{E}^{\mathbb{Q}}_t \exp(-i_{t+1}-\dots-i_{t+h-1})}_{=i_{t,h}} - \nonumber \\
&& \underbrace{- \frac{1}{h}  \log  \mathbb{E}_t \exp(-i_{t+1}-\dots-i_{t+h-1}).}_{=i^{EH}_{t,h}}(\#eq:TP)
\end{eqnarray}

What is the economic meaning of the term premium? Under EH, investors are willing to buy a maturity-$h$ bond as long as its expected return is---up to Jensen's inequality---equal to the average of future short-term rates. (Hence the definition of $i^{EH}_{t,h}$, see Eq. \@ref(eq:REH).) When $TP_{t,h}>0$, investors are willing to buy the maturity-$h$ bond only if its return is, on average, higher than expected future short-term rates; this corresponds to a situation where investors consider that long-term bonds tend to lose value in *bad states of the world* (i.e., states of high marginal utility).


> **_Risk premium:_** According to \@ref(eq:basic), the price of any asset $j$ satisfies:
$$
p_{jt} = \mathbb{E}_t(\mathcal{M}_{t,t+1} p_{j,t+1}).
$$
The previous equation rewrites:
$$
p_{jt} =  \mathbb{C}ov_t(\mathcal{M}_{t,t+1}, p_{j,t+1}) + \mathbb{E}_t(\mathcal{M}_{t,t+1})\mathbb{E}_t( p_{j,t+1})
$$
or
\begin{equation}
p_{jt} = \underbrace{\exp(-i_t)\mathbb{E}_t( p_{j,t+1})}_{=p^{EH}_{jt}} + \underbrace{\mathbb{C}ov_t(\mathcal{M}_{t,t+1}, p_{j,t+1})}_{\mbox{Risk premium}}.(\#eq:CovRP)
\end{equation}
If investors were not risk-averse, then we would have $p_{jt} = p^{EH}_{jt}$. The SDF is high (resp. low) in bad (resp. good) states of the world (states of high marginal utility in the equilibrium approach). Hence, we have $p_{jt}< p^{EH}_{jt}$ if asset $j$ tends to pay less in bad states of the world (i.e., if $\mathbb{C}ov_t(\mathcal{M}_{t,t+1}, p_{j,t+1})<0$).



If agents were risk-neutral, we would have:
$$
B_{t,n} = \exp(-i_{t,m})\mathbb{E}_t(B_{t+m,n-m}).
$$
This would imply:
$$
-n i_{t,n} = -i_{t,m} + \log \mathbb{E}_t[\exp(-(n-m) i_{t+m,n-m})].
$$
Up to the Jensen inequality, and taking expectations on both sides, we get:
$$
-n i_{t,n} \approx \mathbb{E}_t(-i_{t,m} -(n-m) i_{t+m,n-m}).
$$
After having reorganized:
\begin{equation}
\mathbb{E}_t(i_{t+m,n-m}-i_{t,n}) \approx \frac{i_{t,n}-i_{t,m}}{n-m}.(\#eq:CStheo)
\end{equation}

@Campbell_Shiller_1991 have used the previous expression to test for the Expectation hypothesis. Formally, they run the following regressions for different values of $n$ and $m$:
$$
i_{t+m,n-m}-i_{t,n}) = \phi_n\frac{i_{t,n}-i_{t,m}}{n-m} + \varepsilon_{t+m}
$$

According to \@ref(eq:CStheo), under the Expectation Hypothesis, we should have $\phi_{n,m} \approx 1$. But they do find that the $\phi_{n,m}$ are statistically lower than one. Besides, they find that, for a given holding period $m$, the term structure of the $\phi_{n,m}$ decreases with the maturity $n$. Figure \@ref(fig:CSregressions) shows the results of such regressions on a more recent period. It appears that the original results of @Campbell_Shiller_1991 are still valid.


```{r CSregressions, echo=FALSE, fig.cap="Regressions as in Campbell and Shiller (1991). Data are at the monthly frequency; they are collected from the FRED database. The estimation period starts in 1990. The figure reports 90% confidence intervals of the $\\phi_{n,m}$ parameter estimates (Newey-West robust standard deviations).", fig.asp = .6, out.width = "95%", fig.align = 'left-aligned', message=FALSE}
library(sandwich)
lag <- function(X,n){
  X_lag <- 0*X
  N <- max(dim(t(X)))
  X_lag[1:n] <- X[1]
  X_lag[(n+1):N] <- X[1:(N-n)]
  return(X_lag)
}

# Load data in Fred:
library(fredr)
fredr_set_key("df65e14c054697a52b4511e77fcfa1f3")
start_date <- as.Date("1990-01-01"); end_date <- Sys.Date()
f <- function(ticker){
  fredr(series_id = ticker,
        observation_start = start_date,observation_end = end_date,
        frequency = "m",aggregation_method = "avg")
}

par(mfrow=c(1,2))
par(plt=c(.25,.95,.2,.85))

list.of.rates <- c("THREEFY2","THREEFY3","THREEFY5",
                   "THREEFY7","THREEFY10")

for(i in 1:2){
  
  if(i==1){
    lags    <- 3
    regress <- f("DTB3")
    main_title = "3-month holding period"      
  }
  if(i==2){
    lags    <- 6
    regress <- f("DTB6")  
    main_title = "6-month holding period"      
  }
  if(i==3){
    lags    <- 12
    regress <- f("THREEFY1")
    main_title = "12-month holding period"      
  }
  
  res <- matrix(0,5,3)
  res[,1] <- c(2,3,5,7,10)
  
  count <- 0
  for(j in 1:length(list.of.rates)){
    count <- count + 1
    yy <- f(list.of.rates[j])
    DATA <- merge(yy,regress,by="date")
    yn <- DATA$value.x
    y1 <- DATA$value.y
    eq <- lm((yn-lag(yn,lags))~(lag((yn-y1)/2/(12/lags),lags)))
    
    res[count,2] <- eq$coefficients[2]
    res[count,3] <- sqrt(diag(NeweyWest(eq,lag = lags, prewhite = FALSE)))[2]
  }
  
  plot(res[,1],res[,2],ylim=c(-1,1),pch=16,
       ylab=expression(paste("Parameter ",phi[n*','*m])),
       xlab=expression(paste("Maturity (in years)")),col="black",
       main=main_title,cex=1.5,cex.main=1)
  lines(res[,1],res[,2],lwd=3)
  lines(res[,1],res[,2]-1.64*res[,3],lty=1,col="red",lwd=3)
  lines(res[,1],res[,2]+1.64*res[,3],lty=1,col="red",lwd=3)
  lines(res[,1],0*res[,1],lty=3,lwd=2)
}
```


## The Affine Case {#RiskFreeAffine}

### Affine yields {#AffineYields}

In this subsection, we consider the case where the state vector $w_t$ is affine under both $\mathbb{P}$ and $\mathbb{Q}$. If the nominal short-term rate is affine in $w_t$, i.e., if $i_t = \omega_0 + \omega'_1 w_t$, then (see \@ref(eq:ihandM)):
\begin{eqnarray*}
B_{t,h} &=& \mathbb{E}^{\mathbb{Q}}_t \exp (-i_{t}-\dots-i_{t+h-1})\\
&=& \exp(-h\omega_0 - \omega'_1 w_t) \color{blue}{\mathbb{E}^{\mathbb{Q}}_t \exp (- \omega'_1 w_{t+1}-\dots- \omega'_1 w_{t+h-1})}.
\end{eqnarray*}
The (blue) expectation is easily computed using the recursive equations of Lemma \@ref(lem:MHLT) (see Example \@ref(exm:nominalBth)), leading to:
\begin{equation}
i_{t,h}= -  \frac{1}{h}   \log   B_{t,h} = A_h'w_t + B_h.(\#eq:RthAB)
\end{equation}
It is easily seen that we can also get:
\begin{equation}
i^{EH}_{t,h} = {A^{EH}_h}'w_t + B^{EH}_h.(\#eq:RthABEH)
\end{equation}
Moreover, if inflation is also affine in $w_t$, i.e., if $\pi_{t} = \bar\omega_0 + \bar\omega'_1 w_t$, then real yields are given by:
\begin{eqnarray*}
\mathcal{B}_{t,h} &=& \mathbb{E}^{\mathbb{Q}}_t \exp(-i_{t}-\dots-i_{t+h-1}+\pi_{t+1}+\dots+\pi_{t+h})
\end{eqnarray*}
(see Example \@ref(exm:realBth)) which also leads to:
\begin{equation}
r_{t,h} = -  \frac{1}{h}   \log   \mathcal{B}_{t,h} = \bar{A}_h'w_t + \bar{B}_h.(\#eq:RbarthAB)
\end{equation}
Eqs. \@ref(eq:RthAB) and \@ref(eq:RthABEH) imply that term premiums are affine in $w_t$ (see Eq. \@ref(eq:TP)). Specifically:
$$
TP_{t,h} = i_{t,h} - i^{EH}_{t,h} = B_h - B_h^{EH} + (A_h - A_h^{EH})'w_t.
$$

> The same approach can be employed to compute real term premiums ($r_{t,h} - r^{EH}_{t,h}$), and inflation term premiums($(i_{t,h}-r_{t,h}) - (i^{EH}_{t,h}-r^{EH}_{t,h})$).

Expected excess returns resulting from holding zero-coupon bonds are also affine in $w_t$. Indeed, holding a maturity-$h$ zero-coupon bond for one period provides the following expected gross return:
$$
\mathbb{E}_t\left(\frac{B_{t+1,h-1}}{B_{t,h}}\right) = \mathbb{E}_t\left(\exp(B_{h-1} - B_h + A_{h-1}'w_{t+1} - A_h'w_{t})\right),
$$
which is clearly exponential affine in $w_t$ if $w_t$ is an affine process. Therefore, the log expected excess return, that is:
$$
\log \mathbb{E}_t\left(\frac{B_{t+1,h-1}}{B_{t,h}}\right) - i_t
$$
is also affine in $w_t$. This is exploited in the estimation approach proposed by @Adrian_Crump_Moench_2013.

Moreover, *conditional expectations* of future interest rates (real or nominal) and of term premiums are also affine in $w_t$. In particular:
\begin{equation}
\mathbb{E}_t[i_{t+k,h}] = \mathbb{E}_t[{A_h}'w_{t+k} + B_h] = {A_h}'\mathbb{E}_t(w_{t+k}) + B_h,(\#eq:condmeanRth)
\end{equation}
and $\mathbb{E}_t(w_{t+k})$ is affine in $w_t$ (see Eq. \@ref(eq:condmean)). This can notably be used at the estimation stage, if one wants to fit survey data (see Subsection \@ref(EstimationPersistency)).

Similarly, *conditional variances* of future interest rates (real or nominal) and of term premiums are affine in $w_t$. In particular:
\begin{equation}
\mathbb{V}ar_t[i_{t+k,h}] = \mathbb{V}ar_t[{A_h}'w_{t+k} + B_h] = {A_h}'\mathbb{V}ar_t(w_{t+k})A_h,(\#eq:condvarRth)
\end{equation}
where the components of $\mathbb{V}ar_t(w_{t+k})$ (and therefore $\mathbb{V}ar_t[i_{t+k,h}]$) is affine in $w_t$ (see Eq. \@ref(eq:condvar)). This can also be used at the estimation stage, if one wants to fit (proxies of) conditional variances [@zarg_2017].


### Maximum Sharpe ratio

In an affine model, the maximum Sharpe ratio is easily computed. This has been noted early by @Duffee_2010 for the Gaussian model; @Gourieroux_Monfort_Mouabbi_Renne_2021 and @Pallara_Renne_2023 use it in more sophisticated affine models.

Let us derive the maximum Sharpe ratio in the context of a genral affine framework. Eq. \@ref(eq:CovRP) implies that
$$
\mathbb{E}_t\underbrace{\left(\frac{p_{j,t+1}}{p_{j,t}} - \exp(i_t)\right)}_{=xs_{j,t+1},\mbox{ excess return}} =  - \exp(i_t) \mathbb{C}ov_t\left(\mathcal{M}_{t,t+1},\frac{p_{j,t+1}}{p_{j,t}}\right),
$$
and, using $|\mathbb{C}ov(X,Y)| \le \sqrt{\mathbb{V}ar(X)\mathbb{V}ar(Y)}$, we get the @Hansen_Jagannathan_1991 bound:
\begin{equation}
\underbrace{\frac{\mathbb{E}_t(xs_{j,t+1})}{\sqrt{\mathbb{V}ar_t(xs_{j,t+1})}}}_{\mbox{Sharpe ratio}} \le \underbrace{\frac{\sqrt{\mathbb{V}ar_t(\mathcal{M}_{t,t+1})}}{\mathbb{E}_t(\mathcal{M}_{t,t+1})}}_{\mbox{Maximum Sharpe ratio}}.
\end{equation}

If the SDF is given by $\mathcal{M}_{t,t+1} = \exp[-i_{t}+\alpha'_tw_{t+1}-\psi_t(\alpha_t)]$ (Eq. \@ref(eq:keySDF)), and using that $\mathbb{E}_t(\mathcal{M}_{t,t+1}^2)=\exp(-2i_t+\psi_t(2\alpha_t)-2\psi_t(\alpha_t))$ we get:
$$
\mbox{Maximum Sharpe ratio} = \sqrt{\exp(\psi_t(2\alpha_t)-2\psi_t(\alpha_t)) - 1}.
$$


## Gaussian Affine Term Structure Model {#RiskFreeGaussian}

The Gaussian Affine Term Structure Model (GATSM) is a *workhorse* model, widely used in academic and economic-policy circles. In a GATSM, $w_t$ follows a Gaussian vector autoregressive model, and is therefore affine under $\mathbb{P}$. The SDF is exponential affine in $w_t$, which implies that process $w_t$ is also affine under $\mathbb{Q}$ (shown below). Since the components of $w_t$ are valued in $\mathbb{R}$, one can easily introduce macro-factors among the state variables.

Let us be more specific. The state vector $w_t$ follows:
\begin{equation}
w_{t+1} = \mu + \Phi w_{t} + \Sigma^{1/2} \varepsilon_{t+1}, \mbox{ where } \varepsilon_{t} \sim  i.i.d. \mathcal{N}(0,Id).(\#eq:GaussianVAR1)
\end{equation}
(The fact that we consider a VAR(1) process is without loss of generality since a VAR(p) admits a VAR(1) companion representation.)

This implies the following Laplace transform for $w_t$ (see Example \@ref(exm:GVAR1)):
$$
\psi_t(u) = \log \mathbb{E}_t(\exp(u'w_{t+1})|\underline{w_t}) = \color{blue}{u'\mu + u'\Phi w_t + \frac{1}{2}u'\Sigma'u}.
$$
Using the notations of \@ref(eq:keySDF), the SDF is defined as:
$$
\mathcal{M}_{t,t+1} = \exp(- i_t + \alpha_t'w_{t+1} - \psi_t(\alpha_t)), \mbox{ where } \alpha_t = \alpha_0 + \alpha_1'w_t.
$$

In that case, using \@ref(eq:transfoPQ), we get:
\begin{eqnarray*}
\psi_t^{\mathbb{Q}}(u) &=& \psi_t(u + \alpha_t) - \psi_t(\alpha_t)\\
&=& (u + \alpha_t)'\mu + (u + \alpha_t)'\Phi w_t + \frac{1}{2}(u + \alpha_t)'\Sigma(u + \alpha_t) \\
&& - \left(\alpha_t'\mu + \alpha_t'\Phi w_t + \frac{1}{2}\alpha_t'\Sigma\alpha_t\right) \\
&=& \color{blue}{u' \left(\mu + \Sigma \alpha_0 \right) + u'(\Phi + \Sigma \alpha_1')w_t  + \frac{1}{2}u'\Sigma'u}.
\end{eqnarray*}
This is the Laplace tranform of a Gazussiam VAR process (see Example \@ref(exm:GVAR1)); accordingly, the $\mathbb{Q}$-dynamics of $w_t$ is:
$$
w_{t+1} = \mu + \Sigma  \alpha_0 + (\Phi + \Sigma \alpha_1')  w_{t} + \Sigma^{1/2} \varepsilon^*_{t+1}, \mbox{ where } \varepsilon^*_{t} \sim  i.i.d. \mathcal{N}^{\mathbb{Q}}(0,Id).
$$
or
\begin{equation}
w_{t+1} = \mu^{\mathbb{Q}} + \Phi^{\mathbb{Q}} w_{t} + \Sigma^{1/2} \varepsilon^*_{t+1},(\#eq:GaussianQdyn)
\end{equation}
where 
$$
\boxed{\mu^{\mathbb{Q}} = \mu + \Sigma  \alpha_0,\quad \mbox{and} \quad\Phi^{\mathbb{Q}}=\Phi + \Sigma \alpha_1'.}
$$
With affine specifications of the nominal short term rate ($i_{t} = \omega_0 + \omega'_1 w_t$) and of the inflation rate ($\pi_{t} = \bar\omega_0 + \bar\omega'_1 w_t$), we obtain affine formulas for nominal and real yields of any maturity (Eqs. \@ref(eq:RthAB) and \@ref(eq:RbarthAB)).


:::{.example #KimWright name="Kim and Wright (2005)"}
This model is a three-factor *yield-only model* (no macro variables, except inflation in one variant of the model), where the short-term rate reads $i_t = \omega_0 + \omega_{1,1} w_{1,t} +\omega_{1,2} w_{2,t} +\omega_{1,3} w_{3,t}$.

The model estimated by Kalman filter (see Subsection,\@ref(Estimation:KF); the state-space model (Def. \@ref(def:LSSM)) includes survey-based variables (see Subsection \@ref(EstimationPersistency)).

Outputs are [regularly updated by the Federal Reserve Board](https://www.federalreserve.gov/pubs/feds/2005/200533/200533abs.html).

Monthly data on the 6-month and 12-month-ahead forecasts of the three-month T-Bill yield from Blue Chip Financial Forecasts and semiannual data on the average expected three-month T-Bill yield from 6 to 11 years.

```{r fredKW, echo=FALSE, fig.cap="Kim and Wright (2005) outputs.", fig.asp = .6, out.width = "95%", fig.align = 'left-aligned', message=FALSE}
library(fredr)
fredr_set_key("df65e14c054697a52b4511e77fcfa1f3")
start_date <- as.Date("1990-01-01"); end_date <- as.Date("2022-01-01")
f <- function(ticker){
  fredr(series_id = ticker,
        observation_start = start_date,observation_end = end_date,
        frequency = "m",aggregation_method = "avg")
}
yd10 <- f("DGS10")
tp10 <- f("THREEFYTP10")

par(plt=c(.15,.95,.15,.95))
plot(yd10$date,yd10$value,type="l",ylim=c(-1,10),las=1,lwd=2,
     ylab="yield, in percent",xlab="")
lines(tp10$date,tp10$value,lty=2,col="dark grey",lwd=2)
abline(h=0,lty=3)
legend("topright", 
       c("10-year yield","10-year term premium"),
       #pt.bg = c("black","red","blue"),
       #lty=c(1,1), # gives the legend appropriate symbols (lines)       
       lwd=c(2), # line width
       lty=c(1,2),
       #pch=c(19,19,19),
       col=c("black","dark grey"), # gives the legend lines the correct color and width
       seg.len = 4,
       bg = "white"
)

```

:::






:::{.example #AngPiazzesi name="Ang and Piazzesi (2003)"}

@Ang_Piazzesi_2003 propose one of the first paper mixing latent and macrovariables. The set up is also of the form of \@ref(eq:GaussianVAR1), except that the VAR features several lags.^[Note that a VAR with $p$ lags (i.e., a VAR($p$)) admits a VAR(1) companion form.] In their model, $w_t = [f^{o}_{1,t},f^{o}_{2,t},f^{u}_{1,t},f^{u}_{2,t},f^{u}_{3,t}]'$ where:

* $f^{o}_{1,t}$ is the first Principal Component of a set of 3 price indexes (growth rates)
* $f^{o}_{2,t}$ is the first Principal Component of a set of 4 real activity proxies (HELP,  EMPLOY, IP, UE).
* $f^{u}_{i,t}$ are unobserved, or latent, factors.

The nominal short-term rate follows a Taylor rule. And latent factors are estimated via *inversion techniques* (Subsection \@ref(EstimationInversion)).

```{r figAngPiazzesi, fig.align = 'center', out.width = "95%", fig.cap = "Source: Ang and Piazzesi (1998). Impulse response functions.", echo=FALSE}
knitr::include_graphics("figures/AngPiazzesi1.png")
```
:::


:::{.example #JPS name="Joslin, Priebsch and Singleton (2014)"}

@Joslin_Priebsch_Singleton_2014 first note that affine models stating that the short term rate is affine in macro factors imply that macro-factors are *spanned* by the yield curve: macro-factors should be perfectly explained by yields of different maturities. Further, they show that this is not the case in the data. (That is, regressing macro factors on yields provides $R^2$ that are far from one.)

They propose a model where macro factors are unspanned by the yield curve, but can still help predict yields. In their model, $w_t = [\mathcal{P}_t',M_t']'$, where $\mathcal{P}_t$ are yield factors ($\approx$ principal components) and $M_t$ are macro factors. The model is as follows:
\begin{eqnarray*}
i_t &=& \omega_{0} + \omega_{\mathcal{P}}'\mathcal{P}_t \\
\left[\begin{array}{c}\mathcal{P}_t \\ M_t \end{array}\right]
&=&
\left[\begin{array}{cc}\Phi_{\mathcal{P}\mathcal{P}}&\Phi_{\mathcal{P}M} \\
\Phi_{M\mathcal{P}}&\Phi_{MM} \end{array}\right]
\left[\begin{array}{c}\mathcal{P}_{t-1} \\ M_{t-1} \end{array}\right] + \Sigma \varepsilon_t \\
\left[\begin{array}{c}\mathcal{P}_t \\ M_t \end{array}\right] &=& \mu +
\left[\begin{array}{cc}\Phi^{\mathbb{Q}}_{\mathcal{P}\mathcal{P}}&{\color{red}0} \\
\Phi^{\mathbb{Q}}_{M\mathcal{P}}&\Phi^{\mathbb{Q}}_{MM} \end{array}\right]
\left[\begin{array}{c}\mathcal{P}_{t-1} \\ M_{t-1} \end{array}\right] + \Sigma \varepsilon^{\mathbb{Q}}_t,
\end{eqnarray*}
where $\varepsilon_t$ and $\varepsilon^{\mathbb{Q}}_t$ are $\mathcal{N}(0,Id)$ under $\mathbb{P}$ and $\mathbb{Q}$, respectively.

$M_t$ does not Granger-cause $\mathcal{P}_t$ under $\mathbb{Q}$. In other words, $\mathcal{P}_t$ is exogenous under $\mathbb{Q}$. And since $i_t$ is affine in $\mathcal{P}_t$ only (the loadings on $M_t$ are null), it comes that the yield of any maturity $i_{t,h}$ is affine in $\mathcal{P}_t$ only (null loadings on $M_t$). However, since $M_t$ does Granger-cause $\mathcal{P}_t$ under $\mathbb{P}$, the macro-shocks have dynamic effects on the yield curve. In other words, this model reconciles the facts that: 

a. the level, slope and curvature explains the bulk of the variations of the yield curve,
b. macro factors affect yields,
c. the vectorial spaces spanned by yields on the one hand, and macroeconomic factors on the other hand do not coincide.

```{r JPSIRF, fig.align = 'center', out.width = "95%", fig.cap = "Source: Joslin, Priebsch, and Singleton (2014). Impulse response functions.", echo=FALSE}
knitr::include_graphics("figures/JPS_IRF.png")
```
:::


:::{.example #Angetal2011 name="Ang, Boivin, Dong and Loo-Kung (2011)"}

@Ang_Boivin_Dong_LooKung_2011 propose a macro-finance model based on a quadratic framework. The short-term rate follows a Taylor rule with time-varying parameters:
$$
i_t = \omega_0 + a_t g_t + b_t \pi_t,
$$
where $x_t=(g_t,\pi_t,a_t,b_t)'$ follows a Gaussian VAR. This is the context described in Example \@ref(exm:QGVAR1). The previous equation shows that $r_t$ is linear in $w_t = (x_t,vec(x_t x_t')')'$. Specifically:
$$
i_t = \omega_0 + \omega_1'w_t,
$$
with $\omega_1 = [v,vec(V)]'$, where
$$
v = \left[
\begin{array}{c}
0\\
0\\
0\\
0
\end{array}
\right] \quad \mbox{and} \quad V = \left[
\begin{array}{cccc}
0 & 0& 1/2&0\\
0& 0& 0&1/2\\
1/2& 0& 0&0\\
0&1/2 &0 &0
\end{array}
\right].
$$

```{r AngBoivin, fig.align = 'center', out.width = "70%", fig.cap = "Source: Ang, Boivin, Dong, Loo-Kung (2011). Estimated factor loadings ($a_t$ and $b_t$).", echo=FALSE}
knitr::include_graphics("figures/Ang_Boivin_loadings.png")
```
:::




## Non-Negative Affine Term Structure Model {#RiskFreeNonNegative}

In the presence of physical currency, absence of arbitrage opportunity and of storing cost of cash, nominal interest rates should be nonnegative. Many standard models (e.g. Gaussian ATSM) are non consistent with non-negative nominal yields. The period of extremely low interest rates challenged these models. Against this backdrop, approaches have been developed to accommodate zero (or effective) lower bounds. We provide two examples; only the second is an affine model.

### The shadow-rate approach {#Shadowrate}

The shadow-rate model is originally due to @Black_1995. In this model, the short term rate is given by:
\begin{equation}
i_t = \max(s_t,\underline{i}) = \underline{i} + \max(s_t-\underline{i},0),(\#eq:SRSTR)
\end{equation}
where $s_t$ is the shadow short-term interest rate and $\underline{i}$ is the effective lower bound ($\le 0$). While $s_t$ can be real-valued, the short term rate is nonnegative under \@ref(eq:SRSTR). In shadow-rate models, the shadow rate $s_t$ is usually a linear combination of a vector $w_t$ that follows a Gaussian auto-regressive model. While $s_t$ is a linear combination of components of an affine process, this is not the case for $i_t$. As a result, pricing formula are not available in closed-form. Approximation formula have been proposed by, e.g., @Krippner_2013, @Priebsch_2013, @Wu_Xia_2016.

Let us describe the latter approach [@Wu_Xia_2016]. As in Subsection \@ref(RiskFreeGaussian), the SDF is defined as:
$$
\mathcal{M}_{t,t+1} = \exp(- i_t + \alpha_t'w_{t+1} - \psi_t(\alpha_t)), \mbox{ where } \alpha_t = \alpha_0 + \alpha_1'w_t,
$$
(this is Eq. \@ref(eq:keySDF)), but the short-term rate $i_t$ is given by $i_t = \max(s_t,0)$, with
$$
s_t = \delta_0 + \delta_1' w_t.
$$
The shadow rate $s_t$ is part of a state vector $w_t$ that follows a Gaussian VAR, as in \@ref(eq:GaussianVAR1) (or $s_t$ can be a linear combination of components of $w_t$). As before, the $\mathbb{Q}$-dynamics of $w_t$ is also a Gaussian VAR, as in \@ref(eq:GaussianQdyn). (Indeed, using the previous specification of the SDF, the non-linear $i_t$ term vanishes in the Radon-Nikodym derivatives; see Eq. \@ref(eq:RadonNikodym).)

The price of a nominal zero-coupon bond is still given by \@ref(eq:ihandM)), that is:
$$
B_{t,h} = \mathbb{E}^{\mathbb{Q}}_t \exp(-i_t--i_{t+1}-\dots-i_{t+h-1});
$$
but this price is not exponential affine in $s_t$ because of the max operator relating $i_t$ to $s_t$ (see Eq. \@ref(eq:SRSTR)). As a result, we can no longer exploit the tractable calculation of the multi-horizon Laplace transform of $w_t$ to price this bond.

The approximation approach proposed by @Wu_Xia_2016 is based on an approximation to the conditional expectations of forward rates. Using the results of Subsection \@ref(FWD), we have (Eq. \@ref(eq:forward)):
$$
f_{n-1,n,t} = n i_{t,n} - (n-1) i_{t,n-1}.,
$$
for $n>0$ (and using $i_{t,0}=0$, i.e., $f_{0,1,t}=i_t$). Equivalently, for $h>0$:
$$
i_{t,h} =  \frac{1}{h}(f_{t,0,1}+f_{t,1,2}+\dots+f_{t,h-1,h}).
$$

The approximation of @Wu_Xia_2016 consists in finding approximations of the forward rates $f_{t,n-1,n}$ (denoted by $\tilde{f}_{t,n-1,n}$, say) and to use them in the previous equation to get:
\begin{equation}
i_{t,h} \approx  \frac{1}{h}\left(\tilde{f}_{t,0,1}+\tilde{f}_{t,1,2}+\dots+\tilde{f}_{t,h-1,h}\right).(\#eq:RapproxSR)
\end{equation}

Using that, for any random variable $Z$, we have $\log(\mathbb{E}[e^Z]) \approx \mathbb{E}[Z] + \frac{1}{2} \mathbb{V}ar[Z]$ (based on a second order Taylor expansion), @Wu_Xia_2016 further show that:
\begin{eqnarray}
f_{t,n,n+1} &=& -\log\left(\mathbb{E}_t^{\mathbb{Q}}\left(e^{-\sum_{j=0}^n i_{t+j}}\right)\right) + \log\left(\mathbb{E}_t^{\mathbb{Q}}\left(e^{-\sum_{j=0}^{n-1} i_{t+j}}\right)\right)\\
&\approx& \mathbb{E}_t^{\mathbb{Q}}[i_{t+n}] - \frac{1}{2}\left(\mathbb{V}ar_t^{\mathbb{Q}}\left(\sum_{j=0}^n i_{t+j}\right)-\mathbb{V}ar_t^{\mathbb{Q}}\left(\sum_{j=0}^{n-1} i_{t+j}\right)\right).
\end{eqnarray}

The expectation can be computed analytically. Using \@ref(eq:SRSTR), it is indeed of the form $\underline{i} + \mathbb{E}_t^{\mathbb{Q}}[ \max(s_{t+n}-\underline{i},0)]$, where
$$
s_{t+n}-\underline{i}|\underline{w_t} \sim \mathcal{N}\left(\bar{a}_n+b_n'w_t,\sigma_n^{\mathbb{Q}}\right),
$$
with
$$
\bar{a}_n = \delta_0 + \delta_1'\left(\sum_{j=0}^{n-1} \left[\Phi^{\mathbb{Q}}\right]^j\right)\mu^{\mathbb{Q}}, \quad \mbox{and} \quad b_n' = \delta_1'\left(\Phi^{\mathbb{Q}}\right)^n,
$$
and
$$
\sigma_n^{\mathbb{Q}} := \mathbb{V}ar^{\mathbb{Q}}_t\left(s_{t+n}\right)= \delta_1'\left(\sum_{j=0}^{n-1} \left[\Phi^{\mathbb{Q}}\right]^j\right)\Sigma \Sigma' \left(\sum_{j=0}^{n-1} \left[\Phi^{\mathbb{Q}}\right]^j\right)'\delta_1.
$$

Hence, using standard results on the truncated normal distribution (see Figure \@ref(fig:Mills)),^[If $X\sim \mathcal{N}(\mu,\sigma^2)$, then $\mathbb{E}(\max(X,0))=\sigma g\left(\frac{\mu}{\sigma}\right)= \mu\Phi\left(\frac{\mu}{\sigma}\right)+\sigma\phi\left(\frac{\mu}{\sigma}\right)$.] they obtain:
$$
\mathbb{E}_t^{\mathbb{Q}}[i_{t+n}] = \underline{i} + \sigma_n^{\mathbb{Q}}g\left(\frac{\bar{a}_n + b_n'X_t - \underline{i}}{\sigma_n^{\mathbb{Q}}}\right),
$$
where $g(x)= x\Phi(x)+\phi(x)$, $\Phi$ and $\phi$ being the c.d.f. and p.d.f. of the standard normal distribution, respectively.

They also show that
$$
\frac{1}{2}\left(\mathbb{V}ar_t^{\mathbb{Q}}\left(\sum_{j=0}^n i_{t+j}\right)-\mathbb{V}ar_t^{\mathbb{Q}}\left(\sum_{j=0}^{n-1} i_{t+j}\right)\right) \approx \Phi\left(\frac{\bar{a}_n + b_n'X_t - \underline{i}}{\sigma_n^{\mathbb{Q}}}\right)\times(\bar{a}_n - a_n),
$$
where $a_n = \bar{a}_n - \frac{1}{2}\sigma_n^{\mathbb{Q}}$. They finally obtain:
$$
\boxed{f_{t,n,n+1} \approx \tilde{f}_{t,n,n+1} = \underline{i} + \sigma_n^{\mathbb{Q}}g\left(\frac{a_n + b_n'X_t - \underline{i}}{\sigma_n^{\mathbb{Q}}}\right),}
$$
which is used in \@ref(eq:RapproxSR) to obtain an approximation to $i_{t,h}$.


```{r WuXia, fig.align = 'center', out.width = "95%", fig.cap = "The upper plot shows a simulated path of the shadow rate $s_t$. The bottom plot shows the approximated forward rate $f_{t,n,n+1}$ and the resulting nominal rates $i_{t,h}$.",echo=TRUE}
library(TSModels)
# Specify model:
n <- 2 # number of factors
rho <- matrix(0,n,n)
diag(rho) <- .97
mu <- matrix(0,n,1)
Sigma <- diag(n)
delta.0 <- 0;delta.1 <- rep(.01,n)
r.bar <- 0 # r = max(s,r.bar) [i.e., r.bar=0 in standard model]
Model <- list(rho = rho,mu = mu,Sigma = Sigma,
              delta.0 = delta.0,delta.1 = delta.1,r.bar = r.bar)
# Simulate model and compute shadow rate:
X <- simul.var(Model,nb.sim = 200) # simulated path
s <- delta.0 + X %*% delta.1
# Compute yields:
res <- compute.price.WX(Model,X,max.H=100)
# Prepare plots:
par(plt=c(.1,.95,.2,.75))
par(mfrow=c(2,1))
plot(s,type="l",xlab="time",ylab="",lwd=2,main="(a) Shadow rate")
t <- 50 #t <- which(s==min(s))
abline(v=t,col="dark grey",lwd=2,lty=3)
plot(res$vec.f[t,],type="l",xlab="maturity",ylab="",
     lwd=2,main="(b) yields and forward rates")
lines(res$vec.y[t,],col="red",lwd=2)
legend("topright", 
       c("forward rates","yields to maturity"),lwd=c(2),lty=1,
       col=c("black","red"),bg = "white")
```



```{r Mills, fig.align = 'center', out.width = "95%", fig.cap = "This figure shows $\\mathbb{E}(\\max(0,X))$ for $X \\sim \\mathcal{N}(\\mu,1)$, as a function of $\\mu$. More generally, if $X\\sim \\mathcal{N}(\\mu,\\sigma^2)$, then $\\mathbb{E}(\\max(X,0))=\\sigma g\\left(\\frac{\\mu}{\\sigma}\\right)= \\mu\\Phi\\left(\\frac{\\mu}{\\sigma}\\right)+\\sigma\\phi\\left(\\frac{\\mu}{\\sigma}\\right)$, where $\\Phi$ and $\\phi$ are the c.d.f. and p.d.f. of the standard normal distirbution, respectively.",echo=FALSE}
x <- seq(-4,4,length.out=400)
y <- x * pnorm(x) + dnorm(x)
par(plt=c(.15,.95,.2,.95))
plot(x,y,type="l",lwd=2,xlab=expression(mu),ylab="E(max(0,X))")
lines(c(-10,10),c(-10,10),col="grey")
```


### The auto-regressive gamma approach

@zarg_2017 introduce an affine framework where the short-term rate can stay at zero for a prolonged period of time and with a stochastic lift-off probability.

Under $\mathbb{P}$ and $\mathbb{Q}$, the state vector $w_t$ follows a multi-variate auto-regressive gamma (VARG) process---a multivariate extension of Example \@ref(exm:ARG1). Conditionally on $\underline{w_t}$, the $n$ components of $w_{t+1}$ are independent and distributed as follows:
\begin{equation}
\frac{w_{i,t+1}}{\mu_i} \sim \gamma(\nu_i+z_{i,t}) \quad \mbox{where} \quad z_{i,t} \sim {\mathcal P} \left( \alpha_i + \beta_i' w_t \right).(\#eq:VARG)
\end{equation}
If $\mu = (\mu_1,\dots,\mu_n)'$, $\alpha = (\alpha_1,\dots,\alpha_n)'$, $\nu = (\nu_1,\dots,\nu_n)'$ and $\beta = (\beta_1,\dots,\beta_n)$, then
\begin{eqnarray*}
\varphi_t(u) &=& \exp\left[\left(\frac{u \odot \mu}{1 - u \odot \mu}\right)'\beta' w_t \right.\\
&& \left. + \alpha'\left(\frac{u \odot \mu}{1 - u \odot \mu}\right) - \nu'\log(1 - u \odot \mu)\right],
\end{eqnarray*}
where $\odot$ denotes the element-by-element multiplication and, where, with abuse of notation, the division and log operators work element-by-element when applied to vectors.

In their baseline model, @zarg_2017 use four factors. They set $\nu_1 = \nu_2 = 0$, implying that $w_{1,t}$ and $w_{2,t}$ can stay at zero (see Example \@ref(exm:ARG1)). The short-term rate $i_t$ is posited to be an affine combination of $w_{1,t}$ and $w_{2,t}$, that is:
$$
i_t = \omega'w_t = \omega_{1} w_{1,t} + \omega_{2} w_{2,t},
$$
hence, it can stay at zero.

Factors $w_{3,t}$ and $w_{4,t}$ Granger-cause $w_{1,t}$ and $w_{2,t}$, thereby causing $i_t$. As a result, for $h \ge 2$, $i_{t,h}$ is a non-zero combination of the four components of $w_t$.

For the same reason, when $i_t=0$, the lift-off probability depends on $w_{3,t}$ and $w_{4,t}$. The framework offers closed-form solutions for lift-off probabilities. Indeed, using Lemma \@ref(lem:lemPetitLemme):
$$
\mathbb{P}_t(\alpha'w_{t+h}=0) = \lim_{u \rightarrow -\infty} \varphi_{t,h}(0,\dots,0,u\alpha),
$$
where $\varphi_{t,h}$ is the multi-horizon Laplace transform defined in \@ref(eq:multiLT), which can be computed using Proposition \@ref(prp:reverseMLT). We have:
\begin{equation}
\left\{
\begin{array}{l}
\mathbb{P}_t(i_{t+h}>0) = 1 - \lim_{u \rightarrow -\infty} \varphi_{t,h}(0,\dots,0,u\omega) \\ \\
\mathbb{P}_t(i_{t+1}=0,\dots,i_{t+h}=0) = \lim_{u \rightarrow -\infty} \varphi_{t,h}(u\omega,\dots,u\omega,u\omega) \equiv p_{h}\\ \\
\mathbb{P}_t(i_{t+1}=0,\dots,i_{t+h-1}=0,i_{t+h}>0) = p_{h-1} - p_h.
\end{array}
\right.
\end{equation}
Other lift-off probabilities, of the type $\mathbb{P}_t[i_{t+h,k}>threshold]$, can be derived from \@ref(eq:DPS).

@zarg_2017 esitmate this model by means of Kalman filtering techniques (see Subsection \@ref(KalmanQML)). Observed variables include (levels of) yields, as well as survey-based forecasts of yields (see Subsection \@ref(EstimationPersistency) and (e-GARCH-based) proxies of conditional variances (see Eq. \@ref(eq:condvar)).

```{r fitZarg, fig.align = 'center', out.width = "95%", fig.cap = "Source: Monfort et al. (2017). Model fit of conditional variances and surveys of professional forecasters.", echo=FALSE}
knitr::include_graphics("figures/Figure_fit_ZARG.png")
```

```{r liftOff, fig.align = 'center', out.width = "95%", fig.cap = "Source: Monfort et al. (2017). Lift-off probabilities.", echo=FALSE}
knitr::include_graphics("figures/Figure_LiftOff.png")
```

